<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPhone — הוספה/עריכה</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#000;--surface:#161616;--glass:rgba(22,22,22,0.7);--text:#f5f5f7;--dim:#86868b;--blue:#0a84ff;--blue-glow:rgba(10,132,255,0.3);--green:#30d158;--red:#ff453a}
body{font-family:'Outfit',-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;-webkit-font-smoothing:antialiased}

.bg{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
.orb{position:absolute;border-radius:50%;filter:blur(120px);opacity:0.4;animation:morph 25s ease-in-out infinite}
.orb1{width:600px;height:600px;background:radial-gradient(circle,rgba(10,132,255,0.6),transparent 70%);top:-300px;right:20%;animation-delay:0s}
.orb2{width:800px;height:800px;background:radial-gradient(circle,rgba(175,82,222,0.5),transparent 70%);bottom:-400px;left:10%;animation-delay:7s}
@keyframes morph{0%,100%{transform:translate(0,0) scale(1);opacity:0.3}33%{transform:translate(50px,-50px) scale(1.1);opacity:0.5}66%{transform:translate(-30px,40px) scale(0.9);opacity:0.4}}

.nav{position:fixed;top:0;left:0;right:0;height:48px;background:var(--glass);backdrop-filter:saturate(180%) blur(40px);border-bottom:1px solid rgba(255,255,255,0.08);z-index:1000}
.nav-in{max-width:900px;margin:0 auto;height:100%;padding:0 24px;display:flex;align-items:center;justify-content:space-between}
.back{color:var(--blue);text-decoration:none;font-size:15px;font-weight:600;transition:opacity 0.2s}
.back:hover{opacity:0.6}
.nav-title{font-size:15px;font-weight:700}

.hero{position:relative;z-index:1;margin-top:48px;padding:100px 24px 60px;text-align:center}
.hero h1{font-size:clamp(48px,8vw,72px);font-weight:900;letter-spacing:-0.04em;margin-bottom:12px;background:linear-gradient(180deg,#fff 20%,#666 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:fadeUp 0.8s ease 0.2s both}
@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.hero p{font-size:clamp(18px,3vw,22px);color:var(--dim);animation:fadeUp 0.8s ease 0.3s both}

.form-section{position:relative;z-index:10;max-width:900px;margin:0 auto;padding:0 24px 100px;animation:fadeUp 0.8s ease 0.4s both}
.form-box{background:var(--glass);backdrop-filter:blur(60px);border:1px solid rgba(255,255,255,0.1);border-radius:32px;padding:48px;box-shadow:0 8px 32px rgba(0,0,0,0.3),inset 0 1px 0 rgba(255,255,255,0.1)}

.success{display:none;padding:20px 28px;background:rgba(48,209,88,0.1);border:1px solid rgba(48,209,88,0.3);border-radius:20px;color:var(--green);font-size:15px;font-weight:600;margin-bottom:32px;animation:slideDown 0.4s ease}
@keyframes slideDown{from{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}
.success.show{display:block}

.group{margin-bottom:28px}
.group label{display:block;font-size:15px;font-weight:700;margin-bottom:10px;letter-spacing:-0.01em}
input,select{width:100%;height:52px;padding:0 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:16px;color:var(--text);font-size:16px;font-family:inherit;transition:all 0.3s}
input:focus,select:focus{outline:none;background:rgba(255,255,255,0.08);border-color:var(--blue);box-shadow:0 0 0 4px rgba(10,132,255,0.15)}
.group.error input,.group.error select{border-color:var(--red);box-shadow:0 0 0 4px rgba(255,59,48,0.15)}
.hint{display:block;font-size:13px;color:var(--dim);margin-top:8px}
.err-msg{display:none;font-size:13px;color:var(--red);margin-top:8px}
.group.error .err-msg{display:block}

.row{display:grid;grid-template-columns:1fr 1fr;gap:20px}

.acts{display:flex;gap:12px;margin-top:48px;padding-top:36px;border-top:1px solid rgba(255,255,255,0.08)}
.btn{flex:1;height:56px;border:none;border-radius:20px;font-size:17px;font-weight:700;font-family:inherit;cursor:pointer;transition:all 0.3s}
.btn-primary{background:var(--blue);color:#fff;box-shadow:0 4px 16px var(--blue-glow)}
.btn-primary:hover{transform:translateY(-3px);box-shadow:0 8px 24px var(--blue-glow)}
.btn-primary:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.btn-secondary{background:rgba(255,255,255,0.05);color:var(--text);border:1px solid rgba(255,255,255,0.1)}
.btn-secondary:hover{background:rgba(255,255,255,0.08)}

.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(10px);z-index:2000;align-items:center;justify-content:center}
.overlay.show{display:flex}
.spinner-box{background:var(--glass);backdrop-filter:blur(40px);border:1px solid rgba(255,255,255,0.1);border-radius:24px;padding:40px 56px;text-align:center}
.spinner{width:56px;height:56px;border:4px solid rgba(255,255,255,0.1);border-top-color:var(--blue);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 16px}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:768px){
.form-box{padding:32px 24px}
.row{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="bg">
<div class="orb orb1"></div>
<div class="orb orb2"></div>
</div>

<nav class="nav">
<div class="nav-in">
<a href="index.html" class="back">← חזרה</a>
<div class="nav-title" id="navTitle">הוסף iPhone</div>
<div style="width:60px"></div>
</div>
</nav>

<section class="hero">
<h1 id="pageTitle">הוסף iPhone</h1>
<p>הזן את פרטי המכשיר</p>
</section>

<section class="form-section">
<div class="form-box">
<div id="success" class="success"></div>

<form id="form">
<div class="group">
<label for="model">שם הדגם</label>
<input type="text" id="model" placeholder="iPhone 15 Pro Max" required>
<span class="hint">3-30 תווים</span>
<span class="err-msg">שדה זה הוא חובה (3-30 תווים)</span>
</div>

<div class="row">
<div class="group">
<label for="color">צבע</label>
<input type="text" id="color" placeholder="Titanium Blue" required>
<span class="hint">3-30 תווים</span>
<span class="err-msg">שדה זה הוא חובה</span>
</div>
<div class="group">
<label for="storage">נפח אחסון</label>
<select id="storage" required>
<option value="">בחר נפח</option>
<option value="64">64GB</option>
<option value="128">128GB</option>
<option value="256">256GB</option>
<option value="512">512GB</option>
<option value="1024">1TB</option>
</select>
<span class="err-msg">בחר נפח אחסון</span>
</div>
</div>

<div class="row">
<div class="group">
<label for="camera">מספר מצלמות</label>
<input type="number" id="camera" min="1" max="10" placeholder="3" required>
<span class="hint">1-10</span>
<span class="err-msg">הזן מספר בין 1 ל-10</span>
</div>
<div class="group">
<label for="battery">קיבולת סוללה</label>
<input type="number" id="battery" min="2000" max="6000" placeholder="4500" required>
<span class="hint">2000-6000 mAh</span>
<span class="err-msg">הזן מספר בין 2000 ל-6000</span>
</div>
</div>

<div class="group">
<label for="price">מחיר</label>
<input type="number" id="price" step="0.01" min="0" placeholder="4999" required>
<span class="hint">בשקלים</span>
<span class="err-msg">הזן מחיר תקין</span>
</div>

<div class="acts">
<button type="submit" class="btn btn-primary" id="submitBtn">שמור</button>
    <button type="button" class="btn btn-secondary" onclick="location.href='index.html'">ביטול</button>
</div>
</form>
</div>
</section>

<div id="overlay" class="overlay">
<div class="spinner-box">
<div class="spinner"></div>
<div style="color:var(--dim);font-size:17px">שומר...</div>
</div>
</div>

<script>
const API='http://localhost:8081/api/iphone';
let isEdit=false,editId=null;

window.onload=()=>{
const params=new URLSearchParams(location.search);
editId=params.get('id');
if(editId){
isEdit=true;
document.getElementById('pageTitle').textContent='ערוך iPhone';
document.getElementById('navTitle').textContent='ערוך iPhone';
loadData(editId);
}
setupValidation();
};

async function loadData(id){
try{
showLoading(true);
const r=await fetch(`${API}/${id}`);
if(!r.ok)throw new Error();
const d=await r.json();
document.getElementById('model').value=d.model;
document.getElementById('color').value=d.color;
document.getElementById('storage').value=d.storageGb;
document.getElementById('camera').value=d.cameraCount;
document.getElementById('battery').value=d.batteryMah;
document.getElementById('price').value=d.price;
showLoading(false);
}catch{
alert('שגיאה בטעינה');
location.href='index.html';
}
}

function setupValidation(){
const form=document.getElementById('form');
form.querySelectorAll('input,select').forEach(f=>{
f.addEventListener('blur',()=>validate(f));
f.addEventListener('input',()=>{
if(f.parentElement.classList.contains('error'))validate(f);
});
});
form.addEventListener('submit',handleSubmit);
}

function validate(f){
const g=f.parentElement;
let ok=true;
if(f.hasAttribute('required')&&!f.value.trim())ok=false;
if((f.id==='model'||f.id==='color')&&(f.value.length<3||f.value.length>30))ok=false;
if(f.id==='storage'){const v=parseInt(f.value);if(!v||v<64||v>1024)ok=false}
if(f.id==='camera'){const v=parseInt(f.value);if(!v||v<1||v>10)ok=false}
if(f.id==='battery'){const v=parseInt(f.value);if(!v||v<2000||v>6000)ok=false}
if(f.id==='price'){const v=parseFloat(f.value);if(isNaN(v)||v<0)ok=false}
ok?g.classList.remove('error'):g.classList.add('error');
return ok;
}

function validateAll(){
const form=document.getElementById('form');
let ok=true;
form.querySelectorAll('input,select').forEach(f=>{if(!validate(f))ok=false});
return ok;
}

async function handleSubmit(e){
e.preventDefault();
if(!validateAll())return;
const data={
model:document.getElementById('model').value.trim(),
color:document.getElementById('color').value.trim(),
storageGb:parseInt(document.getElementById('storage').value),
cameraCount:parseInt(document.getElementById('camera').value),
batteryMah:parseInt(document.getElementById('battery').value),
price:parseFloat(document.getElementById('price').value)
};
try{
showLoading(true);
const url=isEdit?`${API}/${editId}`:API;
const method=isEdit?'PUT':'POST';
const r=await fetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
if(!r.ok)throw new Error();
showLoading(false);
showSuccess(isEdit?'המכשיר עודכן בהצלחה':'המכשיר נוסף בהצלחה');
setTimeout(()=>location.href='index.html',1500);
}catch{
showLoading(false);
alert('שגיאה בשמירה');
}
}

function showLoading(show){
document.getElementById('overlay').classList.toggle('show',show);
}

function showSuccess(msg){
const s=document.getElementById('success');
s.textContent=msg;
s.classList.add('show');
}
</script>
</body>
</html>
